version: '3.8'

services:
  # In Dev, we expose DB/Redis so local Node.js process can connect
  postgres:
    ports:
      - "5432:5432"

  redis:
    ports:
      - "6379:6379"

  # Evolution API for Local WhatsApp Testing
  evolution-api:
    image: evoapicloud/evolution-api:v2.3.7
    container_name: mepoupay_evolution_dev
    restart: unless-stopped
    ports:
      - "8080:8080"
    environment:
      - SERVER_PORT=8080
      - AUTHENTICATION_API_KEY=${EVOLUTION_API_KEY:-429683C4C977415CAAFCCE10F7D57E11}
      - DATABASE_ENABLED=true
      - DATABASE_PROVIDER=postgresql
      - DATABASE_CONNECTION_URI=postgresql://postgres:${POSTGRES_PASSWORD:-postgres}@postgres:5432/finance
      - CACHE_REDIS_ENABLED=true
      - CACHE_REDIS_URI=redis://redis:6379/1
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    volumes:
      - evolution_store_v2:/evolution/store

  # Adminer: Database GUI (Optional, good for dev)
  adminer:
    image: adminer
    restart: always
    ports:
      - 8081:8080

networks:
  default:
    name: mepoupay_network_dev
